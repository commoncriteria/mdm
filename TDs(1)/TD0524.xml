<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../transforms/pp2html.xsl"?>
<?xml-model href="CCProtectionProfile.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<technical-decisions xmlns="https://niap-ccevs.org/cc/v1" xmlns:h="http://www.w3.org/1999/xhtml"> 
<bunch> <applies-to name="Protection Profile for Mobile Device Management" max-inclusive="4.0">  </applies-to>
<decision id="0524"> <notes> Updates to Certificate Revocation (FIA_X509_EXT.1) </notes>

<change xpath=".//f-element[@id='fia_x509_ext.1.1(1)']" mode="replace">  <f-element id="fia_x509_ext.1.1(1)">  <title>  The TSF shall <selectables>  <selectable> invoke platform-provided functionality </selectable> <selectable> implement functionality </selectable> </selectables> to validate certificates in accordance with the following rules: <h:ul> <h:li>  RFC 5280 certificate validation and certificate path validation.  </h:li><h:li>  The certificate path must terminate with a trusted CA certificate.  </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate a certificate path by ensuring the presence of the basicConstraints extension, that the CA flag is set to TRUE for all CA certificates, and that any path constraints are met. </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate that any CA certificate includes caSigning purpose in the key usage field. </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate the revocation status of the certificate using <selectables>  <selectable> OCSP as specified in RFC 6960  </selectable> <selectable>  CRL as specified in RFC 5280 Section 6.3  </selectable> <selectable>  a CRL as specified in RFC 5759 Section 5  </selectable> <selectable>  an OCSP TLS Status Request Extension (i.e., OCSP stapling) as specified in RFC 6066  </selectable> <selectable>  OCSP TLS Multi-Certificate Status Request Extension (i.e., OCSP Multi-Stapling) as specified in RFC 6961  </selectable> </selectables> .  </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate the extendedKeyUsage field according to the following rules: <h:br>  </h:br><h:br>  </h:br><h:ul> <h:li>  Certificates used for trusted updates and executable code integrity verification shall have
the Code Signing purpose (id-kp 3 with OID 1.3.6.1.5.5.7.3.3) in the extendedKeyUsage field.  </h:li><h:li>  Server certificates presented for TLS shall have the Server Authentication purpose (id-kp 1
with OID 1.3.6.1.5.5.7.3.1) in the extendedKeyUsage field.  </h:li><h:li>  Client certificates presented for TLS shall have the Client Authentication purpose (id-kp 2
with OID 1.3.6.1.5.5.7.3.2) in the EKU field.  </h:li><h:li> OCSP certificates presented for OCSP responses shall have the OCSP Signing purpose (id-kp 9
with OID 1.3.6.1.5.5.7.3.9) in the EKU field.  </h:li><h:li>  Server certificates presented for <abbr linkend="EST">  </abbr> shall have the CMC Registration Authority (RA) purpose (id-kp-cmcRA with OID
1.3.6.1.5.5.7.3.28) in the EKU field.  </h:li> </h:ul>  </h:li> </h:ul>  </title> <note role="application">  <linkref linkend="FIA_X509_EXT.1.1(1)">  </linkref> lists the rules for validating certificates. The <abbr linkend="ST">  </abbr> author shall select whether revocation status is verified using OCSP or CRLs. <linkref linkend="FIA_X509_EXT.2">  </linkref> requires that certificates are used for trusted channels; this use requires that the
extendedKeyUsage rules are verified. Certificates may optionally be used for code signing
and policy signing and, if implemented, must be validated to contain the corresponding
extendedKeyUsage. <h:br>  </h:br><h:br>  </h:br> OCSP stapling and OCSP multi-stapling only support TLS server certificate validation. If other certificate types are validated, either OCSP or CRL should be claimed. If OCSP is not supported the EKU provision for checking the OCSP Signing purpose is met by default.<h:br>  </h:br><h:br>  </h:br> Regardless of the selection of  <h:i> implement functionality </h:i>or<h:i> invoke platform-provided
functionality </h:i>, the validation is expected to end in a trusted root CA certificate in a root
store managed by the platform.  </note> <aactivity> <TSS> <h:h4>  If "invoke platform-provided functionality" is selected:  </h:h4> The evaluator shall examine the <abbr linkend="TSS">  </abbr> to verify that it describes (for each supported platform) how this
functionality is invoked (it should be noted that this may be through a mechanism that is not
implemented by the <abbr linkend="MDM">  </abbr> server; nonetheless, that mechanism will be identified in the <abbr linkend="TSS">  </abbr> as part of this evaluation activity). <h:br>  </h:br><h:br>  </h:br> The <abbr linkend="TSS">  </abbr> must describe when revocation checking is performed. It is expected that revocation checking is performed when a certificate is used in an authentication step. It is not sufficient to verify the status of an X.509 certificate only when it is loaded onto the device. <h:h4>  If "implement functionality" is selected:  </h:h4> The evaluator shall ensure the <abbr linkend="TSS">  </abbr> describes where the check of validity of the certificates takes place. The evaluator ensures
the <abbr linkend="TSS">  </abbr> also provides a description of the certificate path validation algorithm. <h:br>  </h:br><h:br>  </h:br> The <abbr linkend="TSS">  </abbr> must describe when revocation checking is performed. It is expected that revocation checking is performed when a certificate is used in an authentication step. It is not sufficient to verify the status of an X.509 certificate only when it is loaded onto the device.<h:br>  </h:br><h:br>  </h:br> </TSS> <Tests> <h:h4> If "implement functionality" is selected: </h:h4> The tests described must be performed in conjunction with the other certificate services
evaluation activities, including each of the functions in<linkref linkend="FIA_X509_EXT.2.1">  </linkref>. The tests for the extendedKeyUsage rules are performed in conjunction with the uses that
require those rules. The evaluator shall create a chain of at least three certificates: the
node certificate to be tested, an Intermediate CA, and the self-signed Root CA. <testlist> <test> The evaluator shall demonstrate that validating a certificate without a valid certification path results in the function failing, for each of the following reasons, in turn:<h:ul> <h:li> by establishing a certificate path in which one of the issuing certificates is not a CA certificate, </h:li><h:li> by omitting the basicConstraints field in one of the issuing certificates, </h:li><h:li> by setting the basicConstraints field in an issuing certificate to have CA=False, </h:li><h:li> by omitting the CA signing bit of the key usage field in an issuing certificate, and </h:li><h:li> by setting the path length field of a valid CA field to a value strictly less than the certificate path. </h:li> </h:ul>The evaluator shall then establish a valid certificate path consisting of valid CA certificates, and demonstrate that the function succeeds. The evaluator shall then remove trust in one of the CA certificates, and show that the function fails. </test><test>  The evaluator shall demonstrate that validating an expired certificate results in the
function failing.  </test><test>  The evaluator shall test that the <abbr linkend="TOE">  </abbr> can properly handle revoked certificates--conditional on whether CRL, OCSP or OCSP stapling
is selected; if multiple methods are selected, then a test shall be performed for each method.
The evaluator shall test revocation of the node certificate and revocation of the
intermediate CA certificate (i.e. the intermediate CA certificate should be revoked by the
root CA). If OCSP stapling per RFC 6066 is the only supported revocation method, testing revocation of the intermediate CA certificate is omitted.
The evaluator shall ensure that a valid certificate is used, and that the validation
function succeeds. The evaluator then attempts the test with a certificate that has been
revoked (for each method chosen in the selection) to ensure when the certificate is no longer
valid that the validation function fails.  </test><test>  If OCSP option is selected, the evaluator shall send the TOE an OCSP response signed by a certificate that does not have the OCSP signing purpose and verify that validation of the OCSP response fails. If CRL is selected, the evaluator shall cause a CA to sign a CRL with a certificate that has a key usage extension but does not have the cRLsign key usage bit set, and verify that validation of the CRL fails. </test><test>  The evaluator shall modify any byte in the first eight bytes of the certificate and demonstrate
that the certificate fails to validate. (The certificate will fail to parse correctly.)  </test><test>  The evaluator shall modify any byte in the last byte of the certificate and demonstrate that the
certificate fails to validate. (The signature on the certificate will not validate.)  </test><test>  The evaluator shall modify any byte in the public key of the certificate and demonstrate that
the certificate fails to validate. (The signature on the certificate will not validate.)  </test><test> <h:br>  </h:br>Test 8a: (Conditional on support for EC certificates as indicated in <linkref linkend="FCS_COP.1(3)">  </linkref>). The evaluator shall establish a valid, trusted certificate chain consisting of an EC leaf certificate, an EC Intermediate CA certificate not designated as a trust anchor, and an EC certificate designated as a trusted anchor, where the elliptic curve parameters are specified as a named curve. The evaluator shall confirm that the TOE validates the certificate chain.<h:br>  </h:br><h:br>  </h:br>Test 8b: (Conditional on support for EC certificates as indicated in <linkref linkend="FCS_COP.1(3)">  </linkref>). The evaluator shall replace the intermediate certificate in the certificate chain for Test 8a with a modified certificate, where the modified intermediate CA has a public key information field where the EC parameters uses an explicit format version of the Elliptic Curve parameters in the public key information field of the intermediate CA certificate from Test 8a, and the modified Intermediate CA certificate is signed by the trusted EC root CA, but having no other changes. The evaluator shall confirm the TOE treats the certificate as invalid. </test> </testlist>  </Tests> </aactivity> </f-element> </change> 

<change xpath=".//f-element[@id='fia_x509_ext.1.1(2)']" mode="replace">  <f-element id="fia_x509_ext.1.1(2)">  <title>  The TSF shall <selectables>  <selectable> invoke platform-provided functionality </selectable> <selectable> implement functionality </selectable> </selectables> to validate certificates in accordance with the following rules: <h:ul> <h:li>  RFC 5280 certificate validation and certificate path validation.  </h:li><h:li>  The certificate path must terminate with a trusted CA certificate.  </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate a certificate path by ensuring the presence of the basicConstraints extension, that the CA flag is set to TRUE for all CA certificates, and that any path constraints are met. </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate that any CA certificate includes caSigning purpose in the key usage field. </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate the revocation status of the certificate using <selectables>  <selectable> OCSP as specified in RFC 6960  </selectable> <selectable>  CRL as specified in RFC 5280 Section 6.3  </selectable> <selectable>  a CRL as specified in RFC 5759 Section 5  </selectable> <selectable>  an OCSP TLS Status Request Extension (i.e., OCSP stapling) as specified in RFC 6066  </selectable> <selectable>  OCSP TLS Multi-Certificate Status Request Extension (i.e., OCSP Multi-Stapling) as specified in RFC 6961  </selectable> <selectable> no revocation method </selectable>
</selectables> .  </h:li><h:li>  The <abbr linkend="TSF">  </abbr> shall validate the extendedKeyUsage field according to the following rules: <h:br>  </h:br><h:br>  </h:br><h:ul> <h:li>  Certificates used for trusted updates and executable code integrity verification shall have
the Code Signing purpose (id-kp 3 with OID 1.3.6.1.5.5.7.3.3) in the extendedKeyUsage field.  </h:li><h:li>  Server certificates presented for TLS shall have the Server Authentication purpose (id-kp 1
with OID 1.3.6.1.5.5.7.3.1) in the extendedKeyUsage field.  </h:li><h:li>  Client certificates presented for TLS shall have the Client Authentication purpose (id-kp 2
with OID 1.3.6.1.5.5.7.3.2) in the EKU field.  </h:li><h:li> OCSP certificates presented for OCSP responses shall have the OCSP Signing purpose (id-kp 9
with OID 1.3.6.1.5.5.7.3.9) in the EKU field.  </h:li><h:li>  Server certificates presented for <abbr linkend="EST">  </abbr> shall have the CMC Registration Authority (RA) purpose (id-kp-cmcRA with OID
1.3.6.1.5.5.7.3.28) in the EKU field.  </h:li> </h:ul>  </h:li> </h:ul>  </title> 

<note role="application">  <linkref linkend="FIA_X509_EXT.1.1(2)">  </linkref> should be chosen if the TOE is distributed and the protocol(s) selected in <linkref linkend="FPT_ITT.1(1)">  </linkref> utilize X.509 certificates for peer authentication. In this case, the use of revocation list checking is optional as there are additional requirements surrounding the enabling and disabling of the ITT channel as defined in <linkref linkend="FCO_CPC_EXT.1">  </linkref>. If revocation checking is not supported, the ST author should select 'no revocation method.' However, if certificate revocation checking is supported, the ST author selects whether this is performed using OCSP or CRLs.
<h:br>  </h:br><h:br>  </h:br>
This SFR lists the rules for validating certificates. The <abbr linkend="ST">  </abbr> author shall select whether revocation status is verified using OCSP or CRLs. <linkref linkend="FIA_X509_EXT.2">  </linkref> requires that certificates are used for trusted channels; this use requires that the
extendedKeyUsage rules are verified. Certificates may optionally be used for code signing
and policy signing and, if implemented, must be validated to contain the corresponding
extendedKeyUsage. 
<h:br>  </h:br><h:br>  </h:br> 
OCSP stapling and OCSP multi-stapling only support TLS server certificate validation. If other certificate types are validated, either OCSP or CRL should be claimed. If OCSP is not supported the EKU provision for checking the OCSP Signing purpose is met by default.
<h:br>  </h:br><h:br>  </h:br> 
Regardless of the selection of  <h:i> implement functionality </h:i>or<h:i> invoke platform-provided
functionality </h:i>, the validation is expected to end in a trusted root CA certificate in a root
store managed by the platform.  </note> 

<aactivity> <TSS> <h:h4>  If "invoke platform-provided functionality" is selected:  </h:h4> The evaluator shall examine the <abbr linkend="TSS">  </abbr> to verify that it describes (for each supported platform) how this
functionality is invoked (it should be noted that this may be through a mechanism that is not
implemented by the <abbr linkend="MDM">  </abbr> server; nonetheless, that mechanism will be identified in the <abbr linkend="TSS">  </abbr> as part of this evaluation activity). <h:br>  </h:br><h:br>  </h:br> The <abbr linkend="TSS">  </abbr> must describe when revocation checking is performed. It is expected that revocation checking is performed when a certificate is used in an authentication step. It is not sufficient to verify the status of an X.509 certificate only when it is loaded onto the device. <h:h4>  If "implement functionality" is selected:  </h:h4> The evaluator shall ensure the <abbr linkend="TSS">  </abbr> describes where the check of validity of the certificates takes place. The evaluator ensures
the <abbr linkend="TSS">  </abbr> also provides a description of the certificate path validation algorithm. <h:br>  </h:br><h:br>  </h:br> The <abbr linkend="TSS">  </abbr> must describe when revocation checking is performed. It is expected that revocation checking is performed when a certificate is used in an authentication step. It is not sufficient to verify the status of an X.509 certificate only when it is loaded onto the device.<h:br>  </h:br><h:br>  </h:br> </TSS> <Tests> <h:h4> If "implement functionality" is selected: </h:h4> The tests described must be performed in conjunction with the other certificate services
evaluation activities, including each of the functions in<linkref linkend="FIA_X509_EXT.2.1">  </linkref>. The tests for the extendedKeyUsage rules are performed in conjunction with the uses that
require those rules. The evaluator shall create a chain of at least three certificates: the
node certificate to be tested, an Intermediate CA, and the self-signed Root CA. <testlist> <test> The evaluator shall demonstrate that validating a certificate without a valid certification path results in the function failing, for each of the following reasons, in turn:<h:ul> <h:li> by establishing a certificate path in which one of the issuing certificates is not a CA certificate, </h:li><h:li> by omitting the basicConstraints field in one of the issuing certificates, </h:li><h:li> by setting the basicConstraints field in an issuing certificate to have CA=False, </h:li><h:li> by omitting the CA signing bit of the key usage field in an issuing certificate, and </h:li><h:li> by setting the path length field of a valid CA field to a value strictly less than the certificate path. </h:li> </h:ul>The evaluator shall then establish a valid certificate path consisting of valid CA certificates, and demonstrate that the function succeeds. The evaluator shall then remove trust in one of the CA certificates, and show that the function fails. </test><test>  The evaluator shall demonstrate that validating an expired certificate results in the
function failing.  </test><test>  The evaluator shall test that the <abbr linkend="TOE">  </abbr> can properly handle revoked certificates--conditional on whether CRL, OCSP or OCSP stapling
is selected; if multiple methods are selected, then a test shall be performed for each method.
The evaluator shall test revocation of the node certificate and revocation of the
intermediate CA certificate (i.e. the intermediate CA certificate should be revoked by the
root CA). If OCSP stapling per RFC 6066 is the only supported revocation method, testing revocation of the intermediate CA certificate is omitted.
The evaluator shall ensure that a valid certificate is used, and that the validation
function succeeds. The evaluator then attempts the test with a certificate that has been
revoked (for each method chosen in the selection) to ensure when the certificate is no longer
valid that the validation function fails.  </test><test>  If OCSP option is selected, the evaluator shall send the TOE an OCSP response signed by a certificate that does not have the OCSP signing purpose and verify that validation of the OCSP response fails. If CRL is selected, the evaluator shall cause a CA to sign a CRL with a certificate that has a key usage extension but does not have the cRLsign key usage bit set, and verify that validation of the CRL fails. </test><test>  The evaluator shall modify any byte in the first eight bytes of the certificate and demonstrate
that the certificate fails to validate. (The certificate will fail to parse correctly.)  </test><test>  The evaluator shall modify any byte in the last byte of the certificate and demonstrate that the
certificate fails to validate. (The signature on the certificate will not validate.)  </test><test>  The evaluator shall modify any byte in the public key of the certificate and demonstrate that
the certificate fails to validate. (The signature on the certificate will not validate.)  </test><test> <h:br>  </h:br>Test 8a: (Conditional on support for EC certificates as indicated in <linkref linkend="FCS_COP.1(3)">  </linkref>). The evaluator shall establish a valid, trusted certificate chain consisting of an EC leaf certificate, an EC Intermediate CA certificate not designated as a trust anchor, and an EC certificate designated as a trusted anchor, where the elliptic curve parameters are specified as a named curve. The evaluator shall confirm that the TOE validates the certificate chain.<h:br>  </h:br><h:br>  </h:br>Test 8b: (Conditional on support for EC certificates as indicated in <linkref linkend="FCS_COP.1(3)">  </linkref>). The evaluator shall replace the intermediate certificate in the certificate chain for Test 8a with a modified certificate, where the modified intermediate CA has a public key information field where the EC parameters uses an explicit format version of the Elliptic Curve parameters in the public key information field of the intermediate CA certificate from Test 8a, and the modified Intermediate CA certificate is signed by the trusted EC root CA, but having no other changes. The evaluator shall confirm the TOE treats the certificate as invalid. </test> </testlist>  </Tests> </aactivity> </f-element> </change> 

        <change xpath=".//f-element[@id='fia_x509_ext.2.2']" mode="replace">
          <f-element id="fia_x509_ext.2.2">
            <title> When the 
              <selectables>
                <selectable>TSF</selectable>
                <selectable><abbr linkend="TOE"/> platform</selectable>
              </selectables> cannot establish a connection to determine the validity of a certificate, the TSF shall 
              <selectables>
                <selectable>invoke platform-provided functionality</selectable>
                <selectable>implement functionality</selectable>
              </selectables> to 
              <selectables>
                <selectable>allow the administrator to choose whether to accept the certificate in these cases</selectable>
                <selectable>accept the certificate</selectable>
                <selectable>not accept the certificate</selectable>
              </selectables>.</title>
            <note role="application">If a valid OCSP response is not provided by the server during a TLS handshake, to include when the TOE does not support OCSP stapling, a connection may need to be established to perform a verification of the revocation status of a certificate - either to download a current, valid CRL or to perform OCSP. The selection is used to describe the behavior in the event that such a connection cannot be established (for example, due to a network error). If the <abbr linkend="TOE"/> has determined the certificate is valid according to all other rules in <linkref linkend="FIA_X509_EXT.1(1)"/>, the behavior indicated in the second selection must determine the validity. The <abbr linkend="TOE"/> must not accept the certificate if it fails any of the other validation rules in <linkref linkend="FIA_X509_EXT.1(1)"/> or if valid revocation information (a cached CRL, or recent or stapled OCSP response) indicates the certificate has been revoked. If the administrator-configured option is selected by the <abbr linkend="ST"/> Author, the <abbr linkend="ST"/> Author must also select function d in <linkref linkend="FMT_SMF.1(2)"/>.<h:br/><h:br/>
              If the <abbr linkend="TOE"/> is distributed and <linkref linkend="FIA_X509_EXT.1(2)"/> is selected, then certificate revocation checking is optional. This is due to additional authorization actions being performed in the enabling and disabling of the intra-<abbr linkend="TOE"/> trusted channel as defined in <linkref linkend="FCO_CPC_EXT.1"/>. In this case, a connection is not required to determine certificate validity and this <abbr linkend="SFR"/> is trivially satisfied.            
            </note>
            <aactivity>
              <TSS>The evaluator shall check the <abbr linkend="TSS"/> to ensure that it describes how the <abbr linkend="TOE"/> chooses which certificates to use, and any necessary instructions in the administrative guidance for configuring the operating environment so that the <abbr linkend="TOE"/> can use the certificates.<h:br/><h:br/>
              If "invoke platform-provided functionality" is selected, the evaluator shall examine the <abbr linkend="TSS"/> to verify that it describes (for each supported platform) how this functionality is invoked (it should be noted that this may be through a mechanism that is not implemented by the <abbr linkend="MDM"/> Server; nonetheless, that mechanism will be identified in the <abbr linkend="TSS"/> as part of this evaluation activity).<h:br/><h:br/>
              If "implement functionality" is selected, the evaluator shall examine the <abbr linkend="TSS"/> to confirm that it describes the behavior of the <abbr linkend="TOE"/> when a connection cannot be established during the validity check of a certificate used in establishing a trusted channel. The evaluator shall verify that any distinctions between trusted channels are described.<h:br/><h:br/> </TSS>
              <Guidance>If the requirement that the administrator is able to specify the default action is selected, then the evaluator shall ensure that the operational guidance contains instructions on how this configuration action is performed.<h:br/><h:br/></Guidance>
              <Tests>The evaluator shall perform the following test for each trusted channel: <testlist>
                  <test>The evaluator shall demonstrate use of a valid certificate requiring certificate validation checking to be performed in at least some part by communicating with a non-<abbr linkend="TOE"/> IT entity. The evaluator shall then manipulate the environment so that the <abbr linkend="TOE"/> is unable to verify the validity of the certificate, and observe that the action selected in <linkref linkend="FIA_X509_EXT.2.2"/> is performed. If the selected action is administrator-configurable, then the evaluator shall follow the operational guidance to determine that all supported administrator-configurable options behave in their documented manner.</test>
                </testlist>
		</Tests>
            </aactivity>
          </f-element>
	</change>

</decision> </bunch> </technical-decisions>